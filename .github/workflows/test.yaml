name: "first try"

on:
  push:
    branches:
      - master
  pull_request:


jobs:
  build:
    name: "Prepare Python env"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        lang: [scala,python]
    steps:
      - uses: actions/checkout@v1
      - name: install java
        uses: AdoptOpenJDK/install-jdk@v1
        with:
          version: '8'
          architecture: x64
      - name: Install dependencies and build the jar
        shell: bash -l {0}
        run: |
          sudo apt-get update
          sudo apt-get install -y make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev python-openssl git
          sudo apt install libedit-dev
          sudo apt install python3-pip --fix-missing
          sudo pip3 install pipenv
          curl https://pyenv.run | bash
          export PATH="~/.pyenv/bin:$PATH"
          eval "$(pyenv init -)"
          eval "$(pyenv virtualenv-init -)"
          pyenv install 3.7.4
          pyenv global system 3.7.4
          pipenv --python 3.7 install
          pipenv run pip install pyspark==3.1.1
          pipenv run pip install flake8==3.5.0 pypandoc==1.3.3
          pipenv run pip install importlib_metadata==3.10.0
      - name: Run Scala /Python Test
        run: |
          export PATH="~/.pyenv/bin:$PATH"
          eval "$(pyenv init -)"
          eval "$(pyenv virtualenv-init -)"
          python run-tests.py 
        env:
          lang: ${{ matrix.lang }}
      # - name: Run Scala test
      #   shell: bash -l {0}
      #   run: |
      #     build/sbt "clean" "test"
      # - name: Run Python test
      #   shell: bash -l {0}
      #   run: |
      #     cd python
      #     python run-tests.py
      # - name: Set up Docker Buildx
      #   uses: docker/setup-buildx-action@v1
      # -name: Run Docker build
      #   shell: bash -l {0}
      #   run: |
      #     docker  build --tag=pydeltalake .
      #     docker run -e  JENKINS_URL -e SBT_1_5_5_MIRROR_JAR_URL pydeltalake:latest



